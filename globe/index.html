<html>
    <head>
        <title>globe</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
        <style>
            html,
            body {
                margin: 0;
                padding: 0;
            }
            body {
                width: 100vw;
                height: 100vh;
                position: relative;
                text-align: center;
                background: rgb(19, 15, 41);
                color: white;
                font-family: Helvetica, Arial, sans-serif;
            }
            canvas {
                position: absolute;
                image-rendering: pixelated;
                width: min(100vw, 100vh) !important;
                height: min(100vw, 100vh) !important;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scaleX(-1);
            }
            .root {
                position: absolute;
                top: 0;
                left: 0;
                width: 200px;
                transform-origin: top left;
            }
            @media only screen and (max-width: 980px) {
                canvas {
                    transform: translate(-50%, -50%) scale(-1, -1);
                }
                .root {
                    transform: scale(2);
                }
            }
        </style>
        <script>
            let planetTexture;
            let camShader;
            let globeDiameterSlider;
            let ringsSlider;
            let ringsDiameterSlider;
            let ringsDistanceSlider;
            let tresholdSlider;
            let textureSlider;
            const textures = [
                'mercury',
                'venus',
                'earth-bw',
                'moon',
                'mars',
            ];
            let loadedTextures = [];

            function preload() {
                camShader = loadShader('./p5assets/treshold.vert', './p5assets/treshold.frag');
            }
            function setup() {
                let root = createDiv().class('root');
                createSpan('globe diameter').position(10, 10).parent(root);
                createSpan('rings count').position(10, 30).parent(root);
                createSpan('rings diameter').position(10, 50).parent(root);
                createSpan('rings distance').position(10, 70).parent(root);
                createSpan('texture').position(10, 90).parent(root);
                createSpan('lightness').position(10, 110).parent(root);
                globeDiameterSlider = createSlider(0, 170, 110).parent(root);
                globeDiameterSlider.position(140, 10);
                globeDiameterSlider.style('width', '80px');
                ringsSlider = createSlider(0, 5, 0).parent(root);
                ringsSlider.position(140, 30);
                ringsSlider.style('width', '80px');
                ringsDiameterSlider = createSlider(0, 20, 1).parent(root);
                ringsDiameterSlider.position(140, 50);
                ringsDiameterSlider.style('width', '80px');
                ringsDistanceSlider = createSlider(0, 30, 10).parent(root);
                ringsDistanceSlider.position(140, 70);
                ringsDistanceSlider.style('width', '80px');
                textureSlider = createSlider(0, textures.length - 1, textures.indexOf('earth'), 1).parent(root);
                textureSlider.position(140, 90);
                textureSlider.style('width', '80px');
                tresholdSlider = createSlider(0.1, 1, 0.35, 0.01).parent(root);
                tresholdSlider.position(140, 110);
                tresholdSlider.style('width', '80px');

                textures.forEach(texture => {
                    loadedTextures.push(loadImage('textures/' + texture + '.jpg'));
                });
                pixelDensity(window.devicePixelRatio * 0.125);
                createCanvas(800, 800, WEBGL);
                pg = createGraphics(800, 800, WEBGL);
            }

            function draw() {
                pg.clear();
                pg.background(255, 0, 0);
                // let locX = mouseX - width / 2;
                // let locY = mouseY - height / 2;
                pg.noStroke();
                pg.fill(color(255, 255, 255));

                pg.push();
                pg.rotateY(frameCount * 0.015);
                pg.rotateZ(0.25);
                pg.rotateX(-0.25);
                pg.rotateY(frameCount * 0.01);

                pg.push();
                let globeDiameter = globeDiameterSlider.value();
                // pg.pointLight(255, 255, 255, -locX, locY, 550);
                pg.texture(loadedTextures[textureSlider.value()]);
                pg.sphere(globeDiameter);
                pg.pop();

                pg.push();
                pg.rotateX(0);
                pg.rotateY(0);
                pg.rotateZ(0);
                pg.rotateX(1.5708);
                let torusDetailY = 2;
                let torusCount = ringsSlider.value();
                let ringsDiameter = ringsDiameterSlider.value();
                let ringsDistance = ringsDistanceSlider.value();
                if (torusCount >= 1) {
                    pg.torus(ringsDistance + globeDiameter + 30, 12 + ringsDiameter, 32, torusDetailY);
                }
                if (torusCount >= 2) {
                    pg.torus(ringsDistance + globeDiameter + 80,  ringsDiameter, 32, torusDetailY);
                }
                if (torusCount >= 3) {
                    pg.torus(ringsDistance + globeDiameter + 100, 1 + ringsDiameter, 32, torusDetailY);
                }
                if (torusCount >= 4) {
                    pg.torus(ringsDistance + globeDiameter + 120, 7 + ringsDiameter, 32, torusDetailY);
                }
                pg.pop();

                pg.pop();
                shader(camShader);
                camShader.setUniform('tex0', pg);
                camShader.setUniform('tresholdValue', tresholdSlider.value());
                rect(0, 0, width, height);
            }

            function keyPressed() {
                if (isLooping()) {
                    noLoop();
                } else {
                    loop();
                }
            }
        </script>
    </head>
    <body>

    </body>
</html>